<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Capital U – Interactive Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0");

    :root {
      --surface: #0f1419;
      --surface-elevated: #1a1f29;
      --surface-muted: #0a0e13;
      --border: #2d3748;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --radius: 14px;
      --pill: 999px;
      --accent: #06b6d4;
      --accent-2: #8b5cf6;
      --teal: #14b8a6;
      --violet: #8b5cf6;
      --violet-light: #a78bfa;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0e13 0%, #1a1f29 100%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .app-shell {
      position: relative;
      width: 390px;
      max-width: 100%;
      height: 844px;
      max-height: 100vh;
      border-radius: 28px;
      background: var(--surface);
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.4), 0 0 80px rgba(14, 184, 166, 0.15);
      overflow: hidden;
    }

    .status-bar {
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 14px;
      font-size: 12px;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      background: var(--surface-elevated);
      position: relative;
      z-index: 2;
    }

    .notch {
      display: none;
    }

    .screen {
      position: absolute;
      inset: 36px 0 72px 0;
      padding: 16px;
      display: none;
      overflow-y: auto;
      background: var(--surface);
    }

    .screen.active {
      display: block;
    }

    .app-title {
      text-align: center;
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 4px;
      color: var(--accent);
      letter-spacing: 0.02em;
    }

    .subtitle {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .xp-card,
    .card,
    .cq-outcome-card,
    .ff-panel,
    .ff-profile-card,
    .ff-league-card,
    .ff-rank-card,
    .ff-standings,
    .ff-matchup {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.3);
    }

    .ff-matchup {
      position: relative;
      overflow: hidden;
    }

    .ff-matchup::before {
      content: "";
      position: absolute;
      inset: -30% 40% auto -10%;
      height: 160px;
      background: radial-gradient(circle at top, rgba(14, 184, 166, 0.18), transparent 60%);
      pointer-events: none;
    }

    .ff-matchup-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .ff-matchup-title {
      font-weight: 700;
      font-size: 14px;
      color: var(--text);
    }

    .ff-week-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: var(--pill);
      border: 1px solid var(--border);
      background: rgba(139, 92, 246, 0.18);
      color: var(--violet-light);
    }

    .ff-matchup-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .ff-team {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px;
      background: rgba(26, 31, 41, 0.8);
    }

    .ff-team-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .ff-team-value {
      font-weight: 700;
      font-size: 15px;
      color: var(--text);
    }

    .ff-team-value.positive {
      color: var(--teal);
    }

    .ff-team-value.negative {
      color: #f87171;
    }

    #ff-lineups-card .stock-list-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      background: rgba(26, 31, 41, 0.8);
      margin-bottom: 8px;
    }

    .xp-row,
    .stat-row,
    .lb-row,
    .ff-actions,
    .cq-btn-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .xp-row,
    .xp-next,
    .lb-sub,
    .cq-helper,
    .info-text,
    .stat-label {
      color: var(--muted);
      font-size: 12px;
    }

    .xp-bar-bg,
    .cq-forecast-bar {
      width: 100%;
      height: 8px;
      border-radius: var(--pill);
      background: #1e293b;
      overflow: hidden;
    }

    .xp-bar-fill,
    .cq-forecast-fill {
      height: 100%;
      width: 0;
      border-radius: var(--pill);
      background: linear-gradient(90deg, var(--teal), var(--violet));
      transition: width 0.25s ease-out;
      box-shadow: 0 0 12px rgba(14, 184, 166, 0.4);
    }

    .xp-chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--pill);
      padding: 4px 10px;
      font-size: 11px;
      background: rgba(14, 184, 166, 0.15);
      color: var(--teal);
      border: 1px solid rgba(14, 184, 166, 0.3);
    }

    .card-title,
    .cq-outcome-title {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 6px;
      color: var(--accent);
    }

    .nav-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin: 10px 0 8px;
    }

    .nav-btn,
    .cq-btn,
    .cq-actions button,
    .ff-menu-btn,
    .ff-mini-btn,
    .ff-actions button,
    #nav-fantasy-btn {
      border-radius: var(--pill);
      border: 1px solid var(--border);
      padding: 10px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: var(--surface-elevated);
      color: var(--text);
      transition: all 0.2s ease;
    }

    .nav-btn:hover,
    .cq-btn:hover,
    .cq-actions button:hover,
    .ff-menu-btn:hover,
    .ff-mini-btn:hover,
    .ff-actions button:hover {
      background: rgba(14, 184, 166, 0.1);
      border-color: var(--teal);
      transform: translateY(-1px);
    }

    .nav-btn.primary,
    .cq-btn.green,
    .cq-actions button.primary,
    .ff-actions button.primary {
      background: linear-gradient(135deg, var(--teal), var(--violet));
      color: #ffffff;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(14, 184, 166, 0.3);
    }

    .nav-btn.green,
    .nav-btn.teal,
    .nav-btn.primary {
      color: #ffffff;
    }

    .nav-btn.green,
    .cq-btn.red {
      background: var(--teal);
      border-color: var(--teal);
    }

    .nav-btn.teal {
      background: var(--violet);
      border-color: var(--violet);
    }

    .nav-btn.locked {
      opacity: 0.6;
      cursor: default;
    }

    .lb-row {
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-bottom: 6px;
      background: rgba(26, 31, 41, 0.5);
    }

    .lb-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .lb-rank {
      width: 18px;
      text-align: center;
      font-weight: 700;
      font-size: 12px;
      color: var(--accent);
    }

    .lb-name {
      font-weight: 600;
      font-size: 13px;
      color: var(--accent);
    }

    .lb-xp {
      font-weight: 600;
      font-size: 12px;
      color: var(--accent);
    }

    .lb-footer {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .lb-link,
    .back-link {
      color: var(--accent-2);
      text-decoration: none;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
    }

    .back-link {
      display: inline-flex;
      gap: 4px;
      margin-bottom: 8px;
    }

    .minty-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      align-items: flex-start;
    }

    .minty-avatar {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: url("minty.png") center center / cover no-repeat;
      flex-shrink: 0;
    }

    .minty-face,
    .minty-smile,
    .minty-leaf {
      display: none;
    }

    .minty-bubble {
      background: var(--surface-elevated);
      color: var(--text);
      border-radius: var(--radius);
      padding: 10px 12px;
      font-size: 12px;
      border: 1px solid var(--border);
      flex: 1;
    }

    .minty-caption {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    .coach-card {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      text-align: center;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
    }

    .coach-avatar {
      width: 128px;
      height: 128px;
      margin: 0 auto 14px;
      border-radius: 28px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.08), transparent 60%),
        linear-gradient(135deg, rgba(20, 184, 166, 0.2), rgba(139, 92, 246, 0.2));
      border: 1px solid var(--border);
      position: relative;
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    .coach-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .coach-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .coach-option {
      width: 100%;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text);
      font-weight: 700;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .coach-option:hover {
      border-color: var(--teal);
      background: rgba(14, 184, 166, 0.12);
      box-shadow: 0 6px 16px rgba(14, 184, 166, 0.18);
    }

    .cq-logo {
      width: 120px;
      margin: 6px auto 10px;
      border-radius: 14px;
      padding: 10px;
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .cq-title {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: var(--accent);
    }

    .cq-body {
      font-size: 13px;
      color: var(--accent);
      text-align: center;
      margin: 4px 0 10px;
    }

    .cq-forecast {
      display: grid;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 12px;
    }

    .cq-forecast-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chart-legend {
      display: flex;
      gap: 12px;
      font-size: 11px;
      color: var(--muted);
      align-items: center;
    }

    .legend-swatch {
      width: 12px;
      height: 6px;
      border-radius: 999px;
    }

    .legend-swatch.assets {
      background: linear-gradient(90deg, var(--teal), var(--violet));
    }

    .legend-swatch.debt {
      background: #ef4444;
      opacity: 0.8;
    }

    .cq-timeline-chart {
      position: relative;
      height: 220px;
      margin: 12px 0;
      padding: 16px 12px 32px 40px;
      background: rgba(26, 31, 41, 0.5);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .cq-chart-svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }

    .cq-chart-line {
      fill: none;
      stroke-width: 2;
      transition: stroke-width 0.3s ease, filter 0.3s ease;
    }

    .cq-chart-line.selected {
      stroke-width: 3;
      filter: drop-shadow(0 0 4px currentColor);
    }

    .cq-chart-dot {
      transition: r 0.3s ease;
    }

    .cq-chart-legend {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 8px 0 12px;
      font-size: 11px;
      color: var(--accent);
      flex-wrap: wrap;
    }

    .cq-chart-legend span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .legend-dot.pay {
      background: var(--teal);
    }

    .legend-dot.save {
      background: var(--violet);
    }

    .legend-dot.invest {
      background: #f59e0b;
    }

    .cq-comparison-table {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin: 12px 0;
    }

    .cq-comparison-col {
      padding: 10px;
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 11px;
      transition: all 0.2s ease;
    }

    .cq-comparison-col.selected {
      background: rgba(139, 92, 246, 0.15);
      border-color: var(--violet);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }

    .cq-comparison-title {
      font-weight: 700;
      font-size: 12px;
      margin-bottom: 8px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .cq-comparison-metric {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: var(--muted);
    }

    .cq-comparison-value {
      font-weight: 600;
      color: var(--accent);
    }

    .cq-comparison-value.positive {
      color: #10b981;
    }

    .cq-comparison-value.negative {
      color: #ef4444;
    }

    .cq-trajectory-card {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      margin-top: 8px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
    }

    .cq-trajectory-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-weight: 700;
      font-size: 12px;
      color: var(--accent);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .cq-trajectory-chart {
      width: 100%;
      height: 220px;
      overflow: hidden;
    }

    .cq-trajectory-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .cq-legend-block {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
    }

    .cq-legend-segment {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .cq-trajectory-dot {
      width: 16px;
      height: 6px;
      border-radius: 999px;
      display: inline-block;
    }

    .cq-legend-line {
      width: 28px;
      height: 3px;
      border-radius: 999px;
      background: var(--legend-line-color, var(--accent));
    }

    .cq-legend-line.dotted {
      background: repeating-linear-gradient(
        to right,
        var(--legend-line-color, var(--accent)) 0,
        var(--legend-line-color, var(--accent)) 4px,
        transparent 4px,
        transparent 8px
      );
    }

    .cq-results-stack {
      display: grid;
      gap: 12px;
    }

    .cq-section-title {
      font-size: 13px;
      font-weight: 800;
      color: var(--accent);
      margin: 6px 0 12px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: inline-block;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 4px;
    }

    .cq-choice-grid {
      display: grid;
      gap: 10px;
      margin: 6px 0 10px;
    }

    .cq-choice {
      text-align: left;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface-elevated);
      padding: 12px;
      cursor: pointer;
      transition: border-color 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      display: grid;
      gap: 6px;
    }

    .cq-choice:hover {
      border-color: var(--teal);
      background: rgba(14, 184, 166, 0.1);
      box-shadow: 0 4px 10px rgba(14, 184, 166, 0.2);
    }

    .cq-choice.active {
      border-color: var(--violet);
      box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
      background: rgba(139, 92, 246, 0.15);
    }

    .cq-choice-title {
      font-weight: 700;
      color: var(--accent);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cq-stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .cq-stack-item {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px 12px;
      background: var(--surface-elevated);
      display: grid;
      gap: 6px;
    }

    .cq-stack-title {
      font-weight: 700;
      color: var(--accent);
      font-size: 13px;
    }

    .cq-stack-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
    }

    .cq-stack-value {
      color: var(--accent);
      font-weight: 700;
    }

    .cq-choice-sub {
      font-size: 11px;
      color: var(--teal);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .cq-result-grid {
      display: grid;
      gap: 12px;
    }

    .cq-result-card {
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      background: radial-gradient(circle at 20% 20%, rgba(14, 184, 166, 0.12), transparent 55%), radial-gradient(circle at 80% 0%, rgba(139, 92, 246, 0.12), transparent 45%), var(--surface-elevated);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .cq-result-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: inherit;
      pointer-events: none;
    }

    .cq-result-card.active {
      border-color: var(--violet);
      box-shadow: 0 12px 26px rgba(139, 92, 246, 0.35);
      transform: translateY(-2px);
    }

    .cq-result-copy {
      font-size: 12px;
      color: #cbd5e1;
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .cq-result-stats {
      display: grid;
      gap: 6px;
      font-size: 12px;
    }

    .cq-result-stats > div {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.02);
    }

    .cq-result-stats .stat-label {
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.03em;
      font-size: 11px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: var(--pill);
      font-size: 11px;
      background: rgba(139, 92, 246, 0.15);
      color: var(--violet-light);
      border: 1px solid rgba(139, 92, 246, 0.3);
      margin-bottom: 6px;
    }

    .info-text {
      line-height: 1.5;
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .stat-tag {
      padding: 2px 8px;
      border-radius: var(--pill);
      background: rgba(14, 184, 166, 0.15);
      color: var(--teal);
      border: 1px solid rgba(14, 184, 166, 0.3);
      font-size: 11px;
    }

    .stat-value {
      font-weight: 600;
      color: var(--text);
    }

    .stat-value.positive {
      color: #10b981;
    }

    .stat-value.negative {
      color: #ef4444;
    }

    .ff-menu-row,
    .ff-mini-btns {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 10px;
    }

    .ff-mini-btns {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .ff-line {
      margin-bottom: 10px;
    }

    .ff-label {
      font-size: 11px;
      color: var(--accent);
      margin-bottom: 4px;
      font-weight: 700;
    }

    .chip-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 7px 10px;
      border-radius: var(--pill);
      border: 1px solid var(--border);
      background: var(--surface-elevated);
      font-size: 11px;
      cursor: pointer;
      color: var(--text);
    }

    .chip.active {
      background: linear-gradient(135deg, var(--teal), var(--violet));
      color: #ffffff;
      border-color: transparent;
    }

    .ff-profile-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 8px;
      font-size: 11px;
    }

    .ff-profile-label {
      color: var(--accent);
      font-weight: 700;
    }

    .ff-list,
    .ff-league-list {
      list-style: none;
      padding: 0;
      margin: 6px 0 0;
      display: grid;
      gap: 6px;
      font-size: 11px;
    }

    .ff-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .ff-pill {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--pill);
      padding: 5px 8px;
      font-size: 11px;
      color: var(--text);
    }

    .ff-league-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--accent);
    }

    .ff-radio {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid var(--teal);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--surface);
    }

    .ff-radio::after {
      content: "";
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--teal);
      opacity: 0;
    }

    .ff-league-item.active .ff-radio::after {
      opacity: 1;
    }

    .ff-standings ul {
      list-style: decimal;
      padding-left: 16px;
      margin: 4px 0 0;
      display: grid;
      gap: 4px;
      color: var(--accent);
      font-size: 12px;
    }

    .toast {
      position: absolute;
      left: 50%;
      bottom: 14px;
      transform: translateX(-50%);
      padding: 8px 12px;
      border-radius: var(--pill);
      font-size: 12px;
      background: linear-gradient(135deg, var(--teal), var(--violet));
      color: #ffffff;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.4);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-out;
      max-width: 90%;
      text-align: center;
    }

    .toast.show {
      opacity: 1;
    }

    .tab-bar {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 64px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      background: var(--surface-elevated);
      border-top: 1px solid var(--border);
      box-shadow: 0 -6px 18px rgba(0, 0, 0, 0.3);
    }

    .tab-btn {
      border: none;
      background: transparent;
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      flex-direction: column;
      transition: color 0.1s ease;
      padding: 8px 0;
      width: 100%;
      height: 100%;
    }

    .tab-btn.active {
      color: var(--teal);
    }

    .tab-icon {
      font-family: "Material Symbols Rounded";
      font-weight: normal;
      font-style: normal;
      font-size: 20px;
      line-height: 1;
    }

    /* Fantasy Finance Stock Cards */
    .draft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(168px, 1fr));
      gap: 10px;
    }

    .stock-card {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      height: 100%;
    }

    .stock-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--teal), var(--violet));
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .stock-card.selected::before {
      opacity: 1;
    }

    .stock-card:hover {
      border-color: var(--teal);
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 8px 20px rgba(14, 184, 166, 0.2);
    }

    .stock-card.selected {
      border-color: var(--violet);
      background: rgba(139, 92, 246, 0.1);
    }

    .stock-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .stock-card-title {
      flex: 1;
    }

    .stock-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 2px;
    }

    .stock-ticker {
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .stock-position-badge {
      padding: 3px 8px;
      border-radius: var(--pill);
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stock-position-badge.growth {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .stock-position-badge.stable {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .stock-position-badge.volatile {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .stock-card-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin: 8px 0;
    }

    .stock-metric {
      font-size: 10px;
    }

    .stock-metric-label {
      color: var(--muted);
      margin-bottom: 2px;
    }

    .stock-metric-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
    }

    .stock-metric-value.positive {
      color: #10b981;
    }

    .stock-metric-value.negative {
      color: #ef4444;
    }

    .stock-sparkline {
      height: 20px;
      display: flex;
      align-items: flex-end;
      gap: 1px;
      margin: 6px 0;
    }

    .stock-sparkline-bar {
      flex: 1;
      background: var(--teal);
      opacity: 0.3;
      border-radius: 2px 2px 0 0;
      transition: opacity 0.2s;
    }

    .stock-card:hover .stock-sparkline-bar {
      opacity: 0.6;
    }

    .stock-risk-meter {
      display: flex;
      gap: 3px;
      align-items: center;
      margin-top: 6px;
    }

    .stock-risk-label {
      font-size: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-right: 4px;
    }

    .stock-risk-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--border);
    }

    .stock-risk-dot.active {
      background: var(--teal);
    }

    .stock-draft-status {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stock-price {
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
    }

    .stock-draft-btn {
      padding: 4px 12px;
      border-radius: var(--pill);
      font-size: 11px;
      font-weight: 600;
      border: 1px solid var(--teal);
      background: rgba(14, 184, 166, 0.1);
      color: var(--teal);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .stock-draft-btn:hover {
      background: var(--teal);
      color: #ffffff;
    }

    .stock-draft-btn.drafted {
      border-color: var(--border);
      background: transparent;
      color: var(--muted);
      cursor: default;
    }

    .draft-header {
      margin-bottom: 12px;
    }

    .draft-stats {
      display: flex;
      gap: 8px;
      margin: 8px 0;
    }

    .draft-stat-chip {
      flex: 1;
      padding: 6px 8px;
      background: rgba(26, 31, 41, 0.5);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      text-align: center;
    }

    .draft-stat-label {
      font-size: 9px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 2px;
    }

    .draft-stat-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .portfolio-summary {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      margin-bottom: 12px;
    }

    .portfolio-total {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--teal), var(--violet));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
    }

    .portfolio-change {
      font-size: 12px;
      font-weight: 600;
    }

    .stock-list-item {
      background: var(--surface-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stock-list-info {
      flex: 1;
    }

    .stock-list-name {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 2px;
    }

    .stock-list-ticker {
      font-size: 10px;
      color: var(--muted);
    }

    .stock-list-perf {
      text-align: right;
    }

    .stock-list-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 2px;
    }

    .stock-list-change {
      font-size: 11px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="notch"></div>
    <div class="status-bar">
    </div>

    <!-- HOME / LEADERBOARD -->
    <section id="screen-home" class="screen active">
      <h1 class="app-title">Capital U</h1>
      <p class="subtitle">Season 1 · Week 5</p>

      <div class="xp-card">
        <div class="xp-row">
          <span id="xp-level-label">Level 7 · Money Mentor</span>
          <span id="xp-amount-label">1,620 / 2,400 XP</span>
        </div>
        <div class="xp-bar-bg">
          <div id="xp-bar-fill" class="xp-bar-fill"></div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
          <div class="xp-next" id="xp-next-label">Next unlock: Fantasy Finance</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Friends Leaderboard</div>

        <div class="lb-row">
          <div class="lb-left">
            <div class="lb-rank">1</div>
            <div>
              <div class="lb-name">Emma</div>
              <div class="lb-sub">Coin Quest streak · 9 days</div>
            </div>
          </div>
          <div class="lb-xp">2,450 XP</div>
        </div>

        <div class="lb-row">
          <div class="lb-left">
            <div class="lb-rank">2</div>
            <div>
              <div class="lb-name">Olivia</div>
              <div class="lb-sub">SmartBudget · 3 goals</div>
            </div>
          </div>
          <div class="lb-xp">1,980 XP</div>
        </div>

        <div class="lb-row" id="lb-you-row">
          <div class="lb-left">
            <div class="lb-rank">3</div>
            <div>
              <div class="lb-name">You</div>
              <div class="lb-sub" id="lb-you-sub">Fantasy Finance · 2–1 record</div>
            </div>
          </div>
          <div class="lb-xp" id="lb-you-xp">1,620 XP</div>
        </div>

        <div class="lb-row">
          <div class="lb-left">
            <div class="lb-rank">4</div>
            <div>
              <div class="lb-name">Ryan</div>
              <div class="lb-sub">New to Coin Quest</div>
            </div>
          </div>
          <div class="lb-xp">980 XP</div>
        </div>

        <div class="lb-footer">
          <span id="lb-global-label">Global: #128 this week</span>
          <a href="javascript:void(0)" class="lb-link">View classroom board</a>
        </div>
      </div>

      <div class="minty-row">
        <div class="minty-avatar">
          <div class="minty-face"></div>
          <div class="minty-smile"></div>
          <div class="minty-leaf"></div>
        </div>
        <div class="minty-bubble">
          <strong>Fantasy Finance</strong> is ready—set your lineup and track your
          matchup. Finish a Coin Quest or add to a savings goal to climb the
          leaderboard faster.
          <div class="minty-caption">Minty · Your money coach</div>
        </div>
      </div>
    </section>

    <!-- SMARTBUDGET -->
    <section id="screen-smartbudget" class="screen">
      <div class="back-link" data-target="screen-home">← Back to Home</div>
      <h1 class="app-title">SmartBudget Coach</h1>
      <p class="subtitle">What is your top financial goal?</p>

      <div class="coach-card">
        <div class="coach-avatar">
          <img src="profile.png" alt="SmartBudget Coach avatar" />
        </div>

        <div class="coach-options">
          <button class="coach-option">Pay off debt</button>
          <button class="coach-option">Save for a goal</button>
          <button class="coach-option">Build an emergency fund</button>
          <button class="coach-option">Track my spending</button>
        </div>
      </div>
    </section>

    <!-- COIN QUEST -->
    <section id="screen-coinquest" class="screen">
      <div class="back-link" data-target="screen-home">← Back to Home</div>
      <h1 class="app-title">Coin Quest</h1>
      <p class="subtitle" style="color:#4b5563;">Windfall · Choose Your Path</p>

      <div class="card">
        <div class="cq-title">Money falls from the sky! You gain $10,000.</div>
        <div class="cq-body" style="text-align:left;margin-bottom:10px;">
          Quick snapshot of what you’re working with:
        </div>
        <div class="cq-stack">
          <div class="cq-stack-item">
            <div class="cq-stack-title">Income</div>
            <div class="cq-stack-row">
              <span>Take-home</span>
              <span class="cq-stack-value">$500 / month</span>
            </div>
          </div>
          <div class="cq-stack-item">
            <div class="cq-stack-title">Loan</div>
            <div class="cq-stack-row">
              <span>Balance</span>
              <span class="cq-stack-value">$10,000</span>
            </div>
            <div class="cq-stack-row">
              <span>Rate & term</span>
              <span class="cq-stack-value">5% · 5 years left</span>
            </div>
            <div class="cq-stack-row">
              <span>Monthly payment</span>
              <span class="cq-stack-value">≈ $190 / month</span>
            </div>
          </div>
          <div class="cq-stack-item">
            <div class="cq-stack-title">Savings</div>
            <div class="cq-stack-row">
              <span>Windfall today</span>
              <span class="cq-stack-value">$10,000</span>
            </div>
            <div class="cq-stack-row">
              <span>Monthly savings</span>
              <span class="cq-stack-value">$310 / month</span>
            </div>
          </div>
        </div>
      </div>

      <div class="cq-choice-grid">
        <button class="cq-choice" id="cq-pay-loan" data-choice="pay">
          <div class="cq-choice-title">
            <span class="material-symbols-rounded" style="font-size:18px;">paid</span>
            Pay off the loan now
          </div>
          <div class="cq-choice-sub">Go Debt Free!</div>
        </button>
        <button class="cq-choice" id="cq-save-cash" data-choice="save">
          <div class="cq-choice-title">
            <span class="material-symbols-rounded" style="font-size:18px;">savings</span>
            Put windfall into savings
          </div>
          <div class="cq-choice-sub">Fill Your Emergency Fund!</div>
        </button>
        <button class="cq-choice" id="cq-invest" data-choice="invest">
          <div class="cq-choice-title">
            <span class="material-symbols-rounded" style="font-size:18px;">trending_up</span>
            Invest it all
          </div>
          <div class="cq-choice-sub">Make Your Money Earn Money!</div>
        </button>
      </div>

      <p class="cq-helper">Pick a path to compare results.</p>
    </section>

    <!-- COIN QUEST RESULTS -->
    <section id="screen-coinquest-results" class="screen">
      <div class="back-link" data-target="screen-coinquest">← Back to Choices</div>
      <h1 class="app-title">Coin Quest</h1>
      <p class="subtitle" style="color:#4b5563;">Windfall · Results</p>

      <div id="cq-results" class="cq-results-stack" style="display:none;">
        <div class="cq-outcome-card">
          <div class="pill" id="cq-pill">Path selected</div>
          <div class="cq-outcome-title" id="cq-outcome-title">Here's what happens</div>
        </div>

        <div class="cq-outcome-card">
          <div class="cq-section-title">Net Worth</div>
          <p class="subtitle" style="margin:4px 0 8px;color:#94a3b8;">Comparison of the three choices ranked by highest net worth.</p>
          <div class="cq-comparison-table" id="cq-comparison">
            <!-- Comparison columns rendered here -->
          </div>

            <div class="cq-trajectory-card">
              <div class="cq-trajectory-header">Debt vs Net Worth (Years 1–5)</div>
              <div class="cq-trajectory-chart" id="cq-trajectory-chart"></div>
              <div class="cq-trajectory-legend">
                <div class="cq-legend-block">
                  <div class="cq-legend-segment">
                    <div class="cq-legend-line solid" style="--legend-line-color:#94a3b8;"></div>
                    <span>Net Worth</span>
                  </div>
                  <div class="cq-legend-segment">
                    <div class="cq-legend-line dotted" style="--legend-line-color:#94a3b8;"></div>
                    <span>Debt</span>
                  </div>
                </div>
                <div class="cq-legend-block">
                  <div class="cq-legend-segment"><span class="cq-trajectory-dot" style="background: #f59e0b;"></span> Invest</div>
                  <div class="cq-legend-segment"><span class="cq-trajectory-dot" style="background: #14b8a6;"></span> Pay Loan</div>
                  <div class="cq-legend-segment"><span class="cq-trajectory-dot" style="background: #8b5cf6;"></span> Save</div>
                </div>
              </div>
            </div>
        </div>

      </div>
    </section>

    <!-- FANTASY FINANCE - DRAFT -->
    <section id="screen-fantasy" class="screen">
      <div class="back-link" data-target="screen-home">← Back to Home</div>
      <h1 class="app-title">Fantasy Finance</h1>
      <p class="subtitle" style="margin-bottom:10px;">Draft Your Portfolio</p>

      <div class="draft-header">
        <div class="draft-stats">
          <div class="draft-stat-chip">
            <div class="draft-stat-label">Budget</div>
            <div class="draft-stat-value" id="draft-budget">$1,000</div>
          </div>
        </div>
      </div>

      <div class="draft-grid">
        <!-- Stock Card 1 -->
        <div class="stock-card" data-stock="nvda">
          <div class="stock-card-header">
            <div class="stock-card-title">
              <div class="stock-name">Nvidia</div>
              <div class="stock-ticker">NVDA</div>
            </div>
          <div class="stock-position-badge volatile">Volatile</div>
        </div>

        <div class="stock-card-metrics">
          <div class="stock-metric">
            <div class="stock-metric-label">YTD Return</div>
            <div class="stock-metric-value positive">+118.7%</div>
          </div>
          <div class="stock-metric">
            <div class="stock-metric-label">30-Day</div>
            <div class="stock-metric-value positive">+23.4%</div>
          </div>
        </div>

          <div class="stock-risk-meter">
            <span class="stock-risk-label">Risk</span>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
          </div>

          <div class="stock-draft-status">
            <div class="stock-price">$495.22</div>
            <button class="stock-draft-btn">Draft</button>
          </div>
        </div>

        <!-- Stock Card 2 -->
        <div class="stock-card" data-stock="msft">
          <div class="stock-card-header">
            <div class="stock-card-title">
              <div class="stock-name">Microsoft</div>
              <div class="stock-ticker">MSFT</div>
            </div>
          <div class="stock-position-badge stable">Stable</div>
        </div>

        <div class="stock-card-metrics">
          <div class="stock-metric">
            <div class="stock-metric-label">YTD Return</div>
            <div class="stock-metric-value positive">+31.2%</div>
          </div>
          <div class="stock-metric">
            <div class="stock-metric-label">30-Day</div>
            <div class="stock-metric-value positive">+6.4%</div>
          </div>
        </div>

          <div class="stock-risk-meter">
            <span class="stock-risk-label">Risk</span>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot"></div>
          </div>

          <div class="stock-draft-status">
            <div class="stock-price">$412.78</div>
            <button class="stock-draft-btn">Draft</button>
          </div>
        </div>

        <!-- Stock Card 3 -->
        <div class="stock-card" data-stock="meta">
          <div class="stock-card-header">
            <div class="stock-card-title">
              <div class="stock-name">Meta Platforms</div>
              <div class="stock-ticker">META</div>
            </div>
          <div class="stock-position-badge growth">Growth</div>
        </div>

        <div class="stock-card-metrics">
          <div class="stock-metric">
            <div class="stock-metric-label">YTD Return</div>
            <div class="stock-metric-value positive">+34.2%</div>
          </div>
          <div class="stock-metric">
            <div class="stock-metric-label">30-Day</div>
            <div class="stock-metric-value positive">+7.9%</div>
          </div>
        </div>

          <div class="stock-risk-meter">
            <span class="stock-risk-label">Risk</span>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot"></div>
          </div>

          <div class="stock-draft-status">
            <div class="stock-price">$309.14</div>
            <button class="stock-draft-btn">Draft</button>
          </div>
        </div>

        <!-- Stock Card 4 -->
        <div class="stock-card" data-stock="gme">
          <div class="stock-card-header">
            <div class="stock-card-title">
              <div class="stock-name">GameStop</div>
              <div class="stock-ticker">GME</div>
            </div>
          <div class="stock-position-badge volatile">Volatile</div>
        </div>

        <div class="stock-card-metrics">
          <div class="stock-metric">
            <div class="stock-metric-label">YTD Return</div>
            <div class="stock-metric-value negative">-12.1%</div>
          </div>
          <div class="stock-metric">
            <div class="stock-metric-label">30-Day</div>
            <div class="stock-metric-value positive">+3.1%</div>
          </div>
        </div>

          <div class="stock-risk-meter">
            <span class="stock-risk-label">Risk</span>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
          </div>

          <div class="stock-draft-status">
            <div class="stock-price">$18.44</div>
            <button class="stock-draft-btn">Draft</button>
          </div>
        </div>

        <!-- Stock Card 5 -->
        <div class="stock-card" data-stock="aapl">
          <div class="stock-card-header">
            <div class="stock-card-title">
              <div class="stock-name">Apple Inc.</div>
              <div class="stock-ticker">AAPL</div>
            </div>
          <div class="stock-position-badge stable">Stable</div>
        </div>

        <div class="stock-card-metrics">
          <div class="stock-metric">
            <div class="stock-metric-label">YTD Return</div>
            <div class="stock-metric-value positive">+24.3%</div>
          </div>
          <div class="stock-metric">
            <div class="stock-metric-label">30-Day</div>
            <div class="stock-metric-value positive">+8.1%</div>
          </div>
        </div>

          <div class="stock-risk-meter">
            <span class="stock-risk-label">Risk</span>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot active"></div>
            <div class="stock-risk-dot"></div>
          </div>

          <div class="stock-draft-status">
            <div class="stock-price">$182.45</div>
            <button class="stock-draft-btn">Draft</button>
          </div>
        </div>
      </div>

      <button class="nav-btn primary" style="width:100%;margin-top:12px;" onclick="navigateTo('screen-fantasy-matchup')">
        View MatchUp →
      </button>
    </section>

    <!-- FANTASY FINANCE - MATCHUP -->
    <section id="screen-fantasy-matchup" class="screen">
      <div class="back-link" data-target="screen-fantasy">← Back to Draft</div>
      <h1 class="app-title">Fantasy Finance</h1>
      <p class="subtitle" style="margin-bottom:12px;">Weekly MatchUp</p>

      <div class="ff-matchup" id="ff-matchup-legacy">
        <div class="ff-matchup-header">
          <div class="ff-matchup-title">Matchup Breakdown</div>
          <div class="ff-week-chip">Week <span id="ff-week-label-legacy">5</span></div>
        </div>
        <div class="ff-matchup-row">
          <div class="ff-team">
            <div class="ff-team-label">You</div>
            <div class="ff-team-value" id="ff-match-total-you">+0.0% ($0)</div>
          </div>
          <div class="ff-team">
            <div class="ff-team-label">Opponent</div>
            <div class="ff-team-value" id="ff-match-total-opp">+0.0% ($0)</div>
          </div>
        </div>
        <div class="info-text" style="margin-top:10px;">Projected gain based on drafted holdings within the $1,000 budget.</div>
      </div>

      <div class="card" id="ff-lineups-card">
        <div class="card-title" style="margin-bottom:6px;">Drafted stocks</div>
        <div class="stat-row" style="align-items:flex-start;">
          <div style="flex:1;">
            <div class="stat-label" style="margin-bottom:6px;">You</div>
            <div id="ff-your-lineup"></div>
          </div>
          <div style="flex:1;">
            <div class="stat-label" style="margin-bottom:6px;">Opponent</div>
            <div id="ff-opponent-lineup"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Toast -->
    <div id="toast" class="toast"></div>
    <nav class="tab-bar">
      <button class="tab-btn active" data-target="screen-home">
        <span class="tab-icon">home</span>
        <span>Home</span>
      </button>
      <button class="tab-btn" data-target="screen-smartbudget">
        <span class="tab-icon">wallet</span>
        <span>SmartBudget</span>
      </button>
      <button class="tab-btn" data-target="screen-coinquest">
        <span class="tab-icon">money_bag</span>
        <span>CoinQuest</span>
      </button>
      <button class="tab-btn" data-target="screen-fantasy">
        <span class="tab-icon">finance_mode</span>
        <span>FantasyFinance</span>
      </button>
    </nav>
  </div>

  <script>
    // Stock database
    const stocksDB = {
      // User draftable
      nvda: { name: 'Nvidia', ticker: 'NVDA', price: 495.22, ytd: 118.7, thirtyDay: 23.4, position: 'Volatile', risk: 3 },
      msft: { name: 'Microsoft', ticker: 'MSFT', price: 412.78, ytd: 31.2, thirtyDay: 6.4, position: 'Stable', risk: 2 },
      meta: { name: 'Meta Platforms', ticker: 'META', price: 309.14, ytd: 34.2, thirtyDay: 7.9, position: 'Growth', risk: 2 },
      gme: { name: 'GameStop', ticker: 'GME', price: 18.44, ytd: -12.1, thirtyDay: 3.1, position: 'Volatile', risk: 3 },
      aapl: { name: 'Apple Inc.', ticker: 'AAPL', price: 182.45, ytd: 24.3, thirtyDay: 8.1, position: 'Stable', risk: 2 },
      // Opponent pool
      tsla: { name: 'Tesla', ticker: 'TSLA', price: 248.92, ytd: 67.8, thirtyDay: -4.2, position: 'Growth', risk: 3 },
      amd: { name: 'AMD', ticker: 'AMD', price: 108.73, ytd: 52.4, thirtyDay: 6.8, position: 'Growth', risk: 3 },
      amzn: { name: 'Amazon', ticker: 'AMZN', price: 178.35, ytd: 42.1, thirtyDay: 11.3, position: 'Growth', risk: 3 },
      goog: { name: 'Alphabet', ticker: 'GOOG', price: 138.12, ytd: 15.6, thirtyDay: 5.3, position: 'Stable', risk: 2 },
      nflx: { name: 'Netflix', ticker: 'NFLX', price: 410.22, ytd: 27.5, thirtyDay: 4.6, position: 'Growth', risk: 2 }
    };

    // Simple global state for the prototype
    const state = {
      xp: 1620,
      xpTarget: 2400,
      fantasyUnlocked: true,
      unlockThreshold: 1800,
      coinQuestChoice: null,
      fantasyLineup: {
        offense: "tech",
        defense: "bonds",
        flex: "index"
      },
      lineupLocked: false,
      matchupWeek: 5,
      draftedStocks: [],  // Array of stock ticker symbols
      draftBudget: 1000,
      maxPicks: 5
    };

    // Opponent lineup prioritized to stay under $1000 total
    const opponentLineup = ['tsla', 'amzn', 'nflx', 'goog']; // ~$975 total

    const coinPaths = {
      pay: {
        pill: "Your choice",
        title: "Pay off the loan now",
        copy: "Clear the 5% loan immediately and let every $500/mo stack in savings from here on.",
        xp: 0,
        xpLabel: ""
      },
      save: {
        pill: "Your choice",
        title: "Save every dollar",
        copy: "Keep the 5% loan but build a cash cushion; you’ll owe some interest, but the money stays liquid.",
        xp: 0,
        xpLabel: ""
      },
      invest: {
        pill: "Your choice",
        title: "Invest every dollar",
        copy: "Keep the 5% loan and invest the $10k windfall plus $500/mo into the market for growth (with risk).",
        xp: 0,
        xpLabel: ""
      }
    };

    const coinChartData = {
      pay: { assets1: 6000, debt1: 0 },
      save: { assets1: 16000, debt1: 10250 },
      invest: { assets1: 16900, debt1: 10250 }
    };

    const ffOptions = {
      offense: {
        tech: { label: "Tech Titans", return: 6.5, risk: 3.2 },
        green: { label: "Green Future", return: 4.1, risk: 2.6 },
        dividend: { label: "Dividend Dash", return: 3.2, risk: 1.9 }
      },
      defense: {
        bonds: { label: "Bond Shield", return: 2.0, risk: 1.1 },
        cash: { label: "Cash Cushion", return: 0.8, risk: 0.6 },
        value: { label: "Value Line", return: 1.4, risk: 1.2 }
      },
      flex: {
        index: { label: "Index All-Stars", return: 3.9, risk: 1.8 },
        energy: { label: "Energy Rush", return: 5.1, risk: 3.1 },
        health: { label: "Health Heroes", return: 3.4, risk: 1.9 }
      }
    };

    const screens = document.querySelectorAll(".screen");
    const toastEl = document.getElementById("toast");
    const tabButtons = document.querySelectorAll(".tab-btn");

    function showScreen(id) {
      screens.forEach((s) => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      tabButtons.forEach((btn) => {
        btn.classList.toggle(
          "active",
          btn.getAttribute("data-target") === id
        );
      });
    }

    function navigateTo(target) {
      if (!target) return;
      showScreen(target);
      const screenEl = document.getElementById(target);
      if (screenEl) screenEl.scrollTop = 0;

      // Update matchup stats when visiting the matchup screen
      if (target === 'screen-fantasy-matchup') {
        renderFantasyStats();
        renderMatchupLineups();
      }
    }

    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add("show");
      setTimeout(() => {
        toastEl.classList.remove("show");
      }, 2200);
    }

    function formatXP(x) {
      return x.toLocaleString() + " XP";
    }

    function formatMoney(amount) {
      return "$" + amount.toFixed(0);
    }

    function formatPercent(value) {
      const sign = value >= 0 ? "+" : "";
      return sign + value.toFixed(1) + "%";
    }

    function setStatValue(el, value) {
      el.classList.remove("positive", "negative");
      if (value > 0) el.classList.add("positive");
      if (value < 0) el.classList.add("negative");
      el.textContent = formatPercent(value);
    }

    function updateXP(delta, sourceLabel) {
      state.xp += delta;
      if (state.xp < 0) state.xp = 0;
      if (state.xp > state.xpTarget) state.xp = state.xpTarget;

      // Update UI
      const xpAmountLabel = document.getElementById("xp-amount-label");
      xpAmountLabel.textContent =
        state.xp.toLocaleString() + " / " + state.xpTarget.toLocaleString() + " XP";

      const pct = (state.xp / state.xpTarget) * 100;
      document.getElementById("xp-bar-fill").style.width = pct + "%";

      const lbXp = document.getElementById("lb-you-xp");
      if (lbXp) lbXp.textContent = formatXP(state.xp);

      const youRow = document.getElementById("lb-you-row");
      if (youRow && state.xp >= 1900) {
        youRow.querySelector(".lb-rank").textContent = "2";
        const globalLabel = document.getElementById("lb-global-label");
        if (globalLabel) globalLabel.textContent = "Global: #96 this week";
      }

      const fantasyBtn = document.getElementById("nav-fantasy-btn");
      const xpNextLabel = document.getElementById("xp-next-label");
      if (fantasyBtn) {
        fantasyBtn.classList.remove("locked");
        fantasyBtn.innerHTML = "Fantasy Finance Football";
      }
      if (xpNextLabel) {
        xpNextLabel.textContent = "Tip: Lock your Fantasy lineup for XP boosts";
      }

      if (sourceLabel) {
        showToast("+" + delta + " XP · " + sourceLabel);
      }
    }

    function calculateProjections() {
      const monthlyIncome = 500;
      const windfall = 10000;
      const loanBalance = 10000;
      const loanRate = 0.05;
      const savingsRate = 0.02;
      const investmentRate = 0.07; // per requirement

      const totalMonths = 60;
      const monthlyLoanRate = loanRate / 12;
      const monthlyInvestmentRate = investmentRate / 12;

      const calcMonthlyPayment = (principal, rate, months) => {
        const r = rate / 12;
        return (principal * r * Math.pow(1 + r, months)) / (Math.pow(1 + r, months) - 1);
      };

      const loanMonthly = calcMonthlyPayment(loanBalance, loanRate, totalMonths);

      const projections = {
        pay: [],
        save: [],
        invest: []
      };

      const pushSnapshot = (bucket, month, savings, investments, debt) => {
        if (month % 12 === 0) {
          const year = month / 12;
          const netWorth = (savings + investments) - debt;
          bucket.push({ year, netWorth, savings, investments, debt });
        }
      };

      // Pay: wipe loan with windfall, save full income monthly (no growth)
      let paySavings = 0;
      let payDebt = 0;
      pushSnapshot(projections.pay, 0, paySavings, 0, payDebt);
      for (let m = 1; m <= totalMonths; m++) {
        paySavings += monthlyIncome; // no growth assumption for cash savings
        pushSnapshot(projections.pay, m, paySavings, 0, payDebt);
      }

      // Save: keep loan, put windfall into savings, amortize loan monthly, no savings growth (per amortization example)
      let saveSavings = windfall;
      let saveDebt = loanBalance;
      pushSnapshot(projections.save, 0, saveSavings, 0, saveDebt);
      for (let m = 1; m <= totalMonths; m++) {
        const interestPayment = saveDebt * monthlyLoanRate;
        const principalPayment = loanMonthly - interestPayment;
        saveDebt = Math.max(0, saveDebt - principalPayment);

        const toSavings = monthlyIncome - loanMonthly;
        saveSavings += toSavings;
        pushSnapshot(projections.save, m, saveSavings, 0, saveDebt);
      }

      // Invest: grow windfall at investmentRate; surplus goes to cash savings while paying amortized loan
      let investInvestments = windfall;
      let investSavings = 0;
      let investDebt = loanBalance;
      pushSnapshot(projections.invest, 0, investSavings, investInvestments, investDebt);
      for (let m = 1; m <= totalMonths; m++) {
        // Grow invested windfall
        investInvestments *= 1 + monthlyInvestmentRate;

        // Add monthly surplus (after loan payment) to savings
        investSavings += monthlyIncome - loanMonthly;

        // Amortize loan
        const interestPayment = investDebt * monthlyLoanRate;
        const principalPayment = loanMonthly - interestPayment;
        investDebt = Math.max(0, investDebt - principalPayment);

        pushSnapshot(projections.invest, m, investSavings, investInvestments, investDebt);
      }

      return projections;
    }

    function renderTimelineChart(selectedChoice) {
      const projections = calculateProjections();
      const chartContainer = document.getElementById("cq-timeline-chart");

      if (!chartContainer) return;

      // Find max value for scaling
      let maxValue = 0;
      ['pay', 'save', 'invest'].forEach(key => {
        projections[key].forEach(point => {
          if (point.netWorth > maxValue) maxValue = point.netWorth;
        });
      });

      // Add some padding to max
      maxValue = Math.ceil(maxValue / 5000) * 5000;

      // Chart dimensions
      const width = 280;
      const height = 160;
      const padding = { top: 10, right: 10, bottom: 20, left: 35 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;

      // Create SVG
      let svg = `<svg class="cq-chart-svg" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">`;

      // Grid lines (horizontal)
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (chartHeight / 4) * i;
        svg += `<line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" stroke="#2d3748" stroke-width="1"/>`;

        // Y-axis labels
        const value = maxValue - (maxValue / 4) * i;
        const label = value >= 1000 ? `$${(value / 1000).toFixed(0)}k` : `$${value}`;
        svg += `<text x="${padding.left - 5}" y="${y + 4}" text-anchor="end" font-size="9" fill="#94a3b8">${label}</text>`;
      }

      // X-axis labels (years)
      for (let year = 0; year <= 5; year++) {
        const x = padding.left + (chartWidth / 5) * year;
        svg += `<text x="${x}" y="${height - 5}" text-anchor="middle" font-size="9" fill="#94a3b8">Yr ${year}</text>`;
      }

      // Helper function to convert data to coordinates
      const toX = (year) => padding.left + (chartWidth / 5) * year;
      const toY = (value) => padding.top + chartHeight - (value / maxValue) * chartHeight;

      // Colors for each choice
      const colors = {
        pay: '#14b8a6',
        save: '#8b5cf6',
        invest: '#f59e0b'
      };

      // Draw lines for each choice
      ['pay', 'save', 'invest'].forEach(key => {
        const points = projections[key];
        const isSelected = key === selectedChoice;
        const strokeWidth = isSelected ? 3 : 2;
        const className = isSelected ? 'selected' : '';

        // Build path
        let pathD = '';
        points.forEach((point, index) => {
          const x = toX(point.year);
          const y = toY(point.netWorth);
          if (index === 0) {
            pathD += `M ${x} ${y}`;
          } else {
            pathD += ` L ${x} ${y}`;
          }
        });

        svg += `<path d="${pathD}" class="cq-chart-line ${className}" stroke="${colors[key]}" stroke-width="${strokeWidth}" fill="none"/>`;

        // Add dots at each point
        points.forEach(point => {
          const x = toX(point.year);
          const y = toY(point.netWorth);
          svg += `<circle cx="${x}" cy="${y}" r="${isSelected ? 4 : 3}" fill="${colors[key]}" class="cq-chart-dot"/>`;
        });
      });

      svg += '</svg>';
      chartContainer.innerHTML = svg;
    }

    function renderComparisonTable(selectedChoice) {
      const projections = calculateProjections();
      const comparisonContainer = document.getElementById("cq-comparison");

      if (!comparisonContainer) return;

      const choices = [
        { key: 'pay', title: 'Pay Loan', icon: 'paid' },
        { key: 'save', title: 'Save', icon: 'savings' },
        { key: 'invest', title: 'Invest', icon: 'trending_up' }
      ].map(choice => {
        const data = projections[choice.key];
        const yr5 = data.find(p => p.year === 5) || { netWorth: 0 };
        return { ...choice, netWorth5: yr5.netWorth };
      }).sort((a, b) => b.netWorth5 - a.netWorth5);

      let html = '';

      choices.forEach(choice => {
        const data = projections[choice.key];
        const isSelected = choice.key === selectedChoice;
        const year1 = data.find(p => p.year === 1).netWorth;
        const year5 = data.find(p => p.year === 5).netWorth;

        const formatValue = (val) => {
          const isPositive = val >= 0;
          const className = isPositive ? 'positive' : 'negative';
          return `<span class="cq-comparison-value ${className}">$${Math.round(val).toLocaleString()}</span>`;
        };

        html += `
          <div class="cq-comparison-col ${isSelected ? 'selected' : ''}">
            <div class="cq-comparison-title">
              <span class="material-symbols-rounded" style="font-size:14px;">${choice.icon}</span>
              ${choice.title}
            </div>
            <div class="cq-comparison-metric">
              <span>Year 1</span>
              ${formatValue(year1)}
            </div>
            <div class="cq-comparison-metric">
              <span>Year 5</span>
              ${formatValue(year5)}
            </div>
          </div>
        `;
      });

      comparisonContainer.innerHTML = html;
    }

    let cqTrajectoryChart = null;

    function renderTrajectoryChart(selectedChoice) {
      const projections = calculateProjections();
      const container = document.getElementById("cq-trajectory-chart");
      if (!container) return;

      container.innerHTML = '<canvas></canvas>';
      const ctx = container.querySelector('canvas').getContext('2d');

      const years = [1, 2, 3, 4, 5];
      const colors = {
        payNet: '#14b8a6',
        payDebt: '#0ea5e9',
        saveNet: '#8b5cf6',
        saveDebt: '#6366f1',
        investNet: '#f59e0b',
        investDebt: '#f97316'
      };

      const datasets = [
        {
          label: 'Pay · Net Worth',
          data: years.map(y => projections.pay.find(p => p.year === y)?.netWorth || 0),
          borderColor: colors.payNet,
          backgroundColor: colors.payNet,
          tension: 0.25,
          borderWidth: selectedChoice === 'pay' ? 3 : 2,
          pointRadius: selectedChoice === 'pay' ? 4 : 3
        },
        {
          label: 'Pay · Debt',
          data: years.map(y => projections.pay.find(p => p.year === y)?.debt || 0),
          borderColor: colors.payDebt,
          backgroundColor: colors.payDebt,
          borderDash: [6, 4],
          tension: 0.25,
          borderWidth: selectedChoice === 'pay' ? 3 : 2,
          pointRadius: selectedChoice === 'pay' ? 4 : 3
        },
        {
          label: 'Save · Net Worth',
          data: years.map(y => projections.save.find(p => p.year === y)?.netWorth || 0),
          borderColor: colors.saveNet,
          backgroundColor: colors.saveNet,
          tension: 0.25,
          borderWidth: selectedChoice === 'save' ? 3 : 2,
          pointRadius: selectedChoice === 'save' ? 4 : 3
        },
        {
          label: 'Save · Debt',
          data: years.map(y => projections.save.find(p => p.year === y)?.debt || 0),
          borderColor: colors.saveDebt,
          backgroundColor: colors.saveDebt,
          borderDash: [6, 4],
          tension: 0.25,
          borderWidth: selectedChoice === 'save' ? 3 : 2,
          pointRadius: selectedChoice === 'save' ? 4 : 3
        },
        {
          label: 'Invest · Net Worth',
          data: years.map(y => projections.invest.find(p => p.year === y)?.netWorth || 0),
          borderColor: colors.investNet,
          backgroundColor: colors.investNet,
          tension: 0.25,
          borderWidth: selectedChoice === 'invest' ? 3 : 2,
          pointRadius: selectedChoice === 'invest' ? 4 : 3
        },
        {
          label: 'Invest · Debt',
          data: years.map(y => projections.invest.find(p => p.year === y)?.debt || 0),
          borderColor: colors.investDebt,
          backgroundColor: colors.investDebt,
          borderDash: [6, 4],
          tension: 0.25,
          borderWidth: selectedChoice === 'invest' ? 3 : 2,
          pointRadius: selectedChoice === 'invest' ? 4 : 3
        }
      ];

      if (cqTrajectoryChart) {
        cqTrajectoryChart.destroy();
      }

      cqTrajectoryChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years.map(y => `Year ${y}`),
          datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: $${Math.round(ctx.parsed.y).toLocaleString()}`
              }
            }
          },
          animation: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: (val) => `$${val.toLocaleString()}`
              },
              grid: { color: 'rgba(255,255,255,0.05)' }
            },
            x: {
              grid: { color: 'rgba(255,255,255,0.04)' }
            }
          }
        }
      });
    }


    function renderCoinQuest(choice) {
      state.coinQuestChoice = choice;
      const data = coinPaths[choice];
      if (!data) return;

      document.getElementById("cq-pill").textContent = data.pill;
      document.getElementById("cq-outcome-title").textContent = data.title;
      const copyEl = document.getElementById("cq-outcome-copy");
      if (copyEl) copyEl.textContent = data.copy;

      document.querySelectorAll(".cq-choice").forEach((btn) => {
        btn.classList.toggle("active", btn.getAttribute("data-choice") === choice);
      });

      document.querySelectorAll(".cq-result-card").forEach((card) => {
        card.classList.toggle("active", card.getAttribute("data-key") === choice);
      });

      // Render the new visualizations
      renderComparisonTable(choice);
      renderTrajectoryChart(choice);

      document.getElementById("cq-results").style.display = "block";
      updateXP(data.xp, data.xpLabel);
      navigateTo("screen-coinquest-results");
    }

    function resetCoinQuest() {
      state.coinQuestChoice = null;
      document.getElementById("cq-results").style.display = "none";
      document
        .querySelectorAll(".cq-choice, .cq-result-card")
        .forEach((el) => el.classList.remove("active"));
      navigateTo("screen-coinquest");
    }

    function renderCoinChart() {}

    function renderPortfolio() {
      if (state.draftedStocks.length === 0) {
        // Show empty state
        const holdingsContainer = document.querySelector('#screen-fantasy-portfolio .card-title');
        if (holdingsContainer && holdingsContainer.nextElementSibling) {
          const emptyMessage = `
            <div style="padding: 40px 20px; text-align: center;">
              <p style="color: var(--muted); font-size: 14px; margin-bottom: 12px;">No stocks drafted yet</p>
              <button class="nav-btn primary" onclick="navigateTo('screen-fantasy')">Start Drafting →</button>
            </div>
          `;
          // Replace holdings
          const firstHolding = holdingsContainer.nextElementSibling;
          if (firstHolding.classList && firstHolding.classList.contains('stock-list-item')) {
            let currentEl = firstHolding;
            while (currentEl && currentEl.classList.contains('stock-list-item')) {
              const next = currentEl.nextElementSibling;
              currentEl.remove();
              currentEl = next;
            }
          }
          holdingsContainer.insertAdjacentHTML('afterend', emptyMessage);
        }

        // Hide portfolio summary
        const summary = document.querySelector('.portfolio-summary');
        if (summary) summary.style.display = 'none';

        return;
      }

      // Calculate total value and performance
      let totalValue = 0;
      let totalReturn = 0;

      state.draftedStocks.forEach(ticker => {
        const stock = stocksDB[ticker];
        totalValue += stock.price;
        totalReturn += stock.ytd;
      });

      const avgReturn = totalReturn / state.draftedStocks.length;
      const initialInvestment = 1000 - state.draftBudget;
      const gainAmount = (initialInvestment * avgReturn) / 100;

      // Update portfolio summary
      const portfolioTotal = document.querySelector('.portfolio-total');
      const portfolioChange = document.querySelector('.portfolio-change');

      if (portfolioTotal) {
        const sign = gainAmount >= 0 ? '+' : '';
        portfolioTotal.textContent = `${sign}$${Math.round(gainAmount).toLocaleString()}`;
      }

      if (portfolioChange) {
        portfolioChange.className = 'portfolio-change';
        portfolioChange.classList.add(avgReturn >= 0 ? 'positive' : 'negative');
        const sign = avgReturn >= 0 ? '+' : '';
        portfolioChange.textContent = `${sign}${avgReturn.toFixed(1)}% Average Return`;
      }

      // Show portfolio summary
      const summary = document.querySelector('.portfolio-summary');
      if (summary) summary.style.display = 'block';

      // Render holdings
      const holdingsTitle = document.querySelector('#screen-fantasy-portfolio .card-title');
      if (holdingsTitle) {
        // Remove existing holdings and empty state
        let currentEl = holdingsTitle.nextElementSibling;
        while (currentEl && (currentEl.classList.contains('stock-list-item') || currentEl.tagName === 'DIV')) {
          const next = currentEl.nextElementSibling;
          if (currentEl.classList.contains('card')) break; // Stop before leaderboard
          currentEl.remove();
          currentEl = next;
        }

        // Add new holdings
        let holdingsHTML = '';
        state.draftedStocks.forEach(ticker => {
          const stock = stocksDB[ticker];
          const valuePerStock = stock.price * (1 + stock.ytd / 100);
          const changeClass = stock.ytd >= 0 ? 'positive' : 'negative';
          const sign = stock.ytd >= 0 ? '+' : '';

          holdingsHTML += `
            <div class="stock-list-item">
              <div class="stock-list-info">
                <div class="stock-list-name">${stock.name}</div>
                <div class="stock-list-ticker">${stock.ticker} • ${stock.position}</div>
              </div>
              <div class="stock-list-perf">
                <div class="stock-list-value">$${Math.round(valuePerStock).toLocaleString()}</div>
                <div class="stock-list-change ${changeClass}">${sign}${stock.ytd}%</div>
              </div>
            </div>
          `;
        });

        holdingsTitle.insertAdjacentHTML('afterend', holdingsHTML);
      }
    }

    function updateLineup(slot, option) {
      state.fantasyLineup[slot] = option;
      document
        .querySelectorAll(`.chip[data-slot="${slot}"]`)
        .forEach((chip) => {
          chip.classList.toggle(
            "active",
            chip.getAttribute("data-option") === option
          );
        });
      renderFantasyStats();
    }

    function renderFantasyStats() {
      const offensePick = ffOptions.offense[state.fantasyLineup.offense];
      const defensePick = ffOptions.defense[state.fantasyLineup.defense];
      const flexPick = ffOptions.flex[state.fantasyLineup.flex];

      const offenseVal = offensePick.return;
      const defenseVal = defensePick.return;
      const flexVal = flexPick.return;
      const risk =
        (offensePick.risk + defensePick.risk + flexPick.risk) / 3;

      const totalVal = offenseVal + defenseVal + flexVal - risk * 0.6;

      const offenseLabel = document.getElementById("ff-offense-label");
      const defenseLabel = document.getElementById("ff-defense-label");
      const flexLabel = document.getElementById("ff-special-label");
      if (offenseLabel) offenseLabel.textContent = `Offense (${offensePick.label})`;
      if (defenseLabel) defenseLabel.textContent = `Defense (${defensePick.label})`;
      if (flexLabel) flexLabel.textContent = `Flex (${flexPick.label})`;

      const offValEl = document.getElementById("ff-offense");
      const defValEl = document.getElementById("ff-defense");
      const flexValEl = document.getElementById("ff-special");
      if (offValEl) setStatValue(offValEl, offenseVal);
      if (defValEl) setStatValue(defValEl, defenseVal);
      if (flexValEl) setStatValue(flexValEl, flexVal - 0.2);
      const totalEl = document.getElementById("ff-total");
      if (totalEl) setStatValue(totalEl, totalVal);

      const rankTag = document.getElementById("ff-rank-tag");
      const rankWord = totalVal > 6 ? "1st among friends" : totalVal > 3 ? "2nd among friends" : "3rd among friends";
      if (rankTag) rankTag.textContent = `Week ${state.matchupWeek} · ${rankWord}`;
      const lbSub = document.getElementById("lb-you-sub");
      if (lbSub) {
        lbSub.textContent = "Fantasy Finance · lineup active";
      }

      const weekLabel = document.getElementById("ff-week-label");
      if (weekLabel) weekLabel.textContent = state.matchupWeek;

      // Legacy matchup block mirrors the panel
      const matchOff = document.getElementById("ff-match-off");
      const matchDef = document.getElementById("ff-match-def");
      const matchSpec = document.getElementById("ff-match-spec");
      const matchTotal = document.getElementById("ff-match-total");
      const weekLegacy = document.getElementById("ff-week-label-legacy");
      if (matchOff) setStatValue(matchOff, offenseVal);
      if (matchDef) setStatValue(matchDef, defenseVal);
      if (matchSpec) setStatValue(matchSpec, flexVal - 0.2);
      if (matchTotal) setStatValue(matchTotal, totalVal);
      if (weekLegacy) weekLegacy.textContent = state.matchupWeek;
    }

    function renderMatchupLineups() {
      const yourList = document.getElementById("ff-your-lineup");
      const oppList = document.getElementById("ff-opponent-lineup");
      if (!yourList || !oppList) return;

      const renderList = (tickers, emptyText) => {
        if (!tickers || tickers.length === 0) {
          return `<p class="info-text" style="margin-bottom:0;">${emptyText}</p>`;
        }

        return tickers
          .map((ticker) => {
            const stock = stocksDB[ticker];
            if (!stock) return '';
            const changeClass = stock.ytd >= 0 ? 'positive' : 'negative';
            const sign = stock.ytd >= 0 ? '+' : '';
            return `
              <div class="stock-list-item" style="padding:8px 10px;margin-bottom:6px;">
                <div class="stock-list-info">
                  <div class="stock-list-name">${stock.name}</div>
                  <div class="stock-list-ticker">${stock.ticker} • ${stock.position}</div>
                </div>
                <div class="stock-list-perf">
                  <div class="stock-list-value">$${Math.round(stock.price).toLocaleString()}</div>
                  <div class="stock-list-change ${changeClass}">${sign}${stock.ytd}%</div>
                </div>
              </div>
            `;
          })
          .join("");
      };

      yourList.innerHTML = renderList(state.draftedStocks, "No picks yet—draft some stocks.");
      oppList.innerHTML = renderList(opponentLineup, "Opponent hasn't set a lineup.");

      renderMatchupBreakdown();
    }

    function calculateLineupPerformance(tickers) {
      let totalCost = 0;
      let totalValue = 0;
      if (!tickers || tickers.length === 0) return { totalCost: 0, pct: 0, gain: 0 };

      tickers.forEach((ticker) => {
        const stock = stocksDB[ticker];
        if (!stock) return;
        totalCost += stock.price;
        totalValue += stock.price * (1 + stock.ytd / 100);
      });

      if (totalCost === 0) return { totalCost: 0, pct: 0, gain: 0 };
      const gain = totalValue - totalCost;
      return { totalCost, pct: (gain / totalCost) * 100, gain };
    }

    function renderMatchupBreakdown() {
      const you = calculateLineupPerformance(state.draftedStocks);
      const opp = calculateLineupPerformance(opponentLineup);

      const youEl = document.getElementById("ff-match-total-you");
      const oppEl = document.getElementById("ff-match-total-opp");
      const totalEl = document.getElementById("ff-total");
      const rivalEl = document.getElementById("ff-rival-projection");

      const formatLine = (perf) => {
        const sign = perf.pct >= 0 ? "+" : "";
        return `${sign}${perf.pct.toFixed(1)}% ($${Math.round(perf.gain).toLocaleString()})`;
      };

      const applyValue = (el, perf) => {
        if (!el) return;
        el.textContent = formatLine(perf);
        el.classList.remove("positive", "negative");
        if (perf.pct > 0) el.classList.add("positive");
        if (perf.pct < 0) el.classList.add("negative");
      };

      applyValue(youEl, you);
      applyValue(oppEl, opp);
      if (totalEl) setStatValue(totalEl, you.pct);
      if (rivalEl) setStatValue(rivalEl, opp.pct);
    }

    // Initial render
    renderFantasyStats();
    renderMatchupLineups();
    updateXP(0);
    const lbSubInit = document.getElementById("lb-you-sub");
    if (lbSubInit) {
      lbSubInit.textContent = "Fantasy Finance · lineup active";
    }

    // Nav buttons (home)
    document.querySelectorAll(".nav-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        if (!target) return;
        if (btn.classList.contains("locked")) {
          showToast("Keep earning XP to unlock this module.");
          return;
        }
        navigateTo(target);
      });
    });

    // Back links
    document.querySelectorAll(".back-link").forEach((link) => {
      link.addEventListener("click", () => {
        const target = link.getAttribute("data-target") || "screen-home";
        navigateTo(target);
      });
    });

    // Tab bar navigation
    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        if (!target) return;
        navigateTo(target);
      });
    });

    // Coin Quest – Choose your path
    document.querySelectorAll(".cq-choice").forEach((btn) => {
      btn.addEventListener("click", () => {
        const choice = btn.getAttribute("data-choice");
        if (!choice) return;
        renderCoinQuest(choice);
      });
    });

    // Fantasy Finance lineup selections
    document.querySelectorAll(".chip").forEach((chip) => {
      chip.addEventListener("click", () => {
        const slot = chip.getAttribute("data-slot");
        const option = chip.getAttribute("data-option");
        updateLineup(slot, option);
      });
    });

    const lockBtn = document.getElementById("ff-lock");
    if (lockBtn) {
      lockBtn.addEventListener("click", () => {
        state.lineupLocked = true;
        updateXP(120, "Fantasy Finance · lineup locked");
        showToast("Lineup locked for the week—check your matchup stats.");
        const lbSubLock = document.getElementById("lb-you-sub");
        if (lbSubLock) {
          lbSubLock.textContent = "Fantasy Finance · lineup locked";
        }
      });
    }

    // Update draft stats display
    function updateDraftStats() {
      const budgetEl = document.getElementById('draft-budget');

      if (budgetEl) {
        budgetEl.textContent = `$${state.draftBudget.toLocaleString()}`;
      }
    }

    // Draft a stock from its card
    function draftStock(card) {
      if (!card) return;

      const stockTicker = card.getAttribute('data-stock');
      const stock = stocksDB[stockTicker];
      const button = card.querySelector('.stock-draft-btn');

      if (!stock) return;

      // If already drafted, deselect it
      if (card.classList.contains('selected') || state.draftedStocks.includes(stockTicker)) {
        state.draftedStocks = state.draftedStocks.filter((t) => t !== stockTicker);
        state.draftBudget += stock.price;
        card.classList.remove('selected');
        if (button) {
          button.textContent = 'Draft';
          button.classList.remove('drafted');
        }
        updateDraftStats();
        renderMatchupLineups();
        showToast(`${stock.name} removed from your lineup.`);
        return;
      }

      // Check limits and budget
      if (state.draftedStocks.length >= state.maxPicks) {
        showToast('Maximum picks reached (5/5)');
        return;
      }

      if (state.draftBudget < stock.price) {
        showToast('Not enough budget for this stock!');
        return;
      }

      state.draftedStocks.push(stockTicker);
      state.draftBudget -= stock.price;

      card.classList.add('selected');
      if (button) {
        button.textContent = 'Drafted';
        button.classList.add('drafted');
      }

      updateDraftStats();
      showToast(`${stock.name} added to portfolio!`);

      // Log for debugging
      console.log('Drafted:', stockTicker, 'Total picks:', state.draftedStocks.length);
      renderMatchupLineups();
    }

    // Fantasy Finance Draft Interactions
    document.querySelectorAll('.stock-draft-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        draftStock(this.closest('.stock-card'));
      });
    });

    // Clicking anywhere on the stock card drafts it
    document.querySelectorAll('.stock-card').forEach(card => {
      card.addEventListener('click', () => draftStock(card));
    });
  </script>
</body>
</html>
